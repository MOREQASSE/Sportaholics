<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sportaholics - Fitness Tracker</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen">
        <div class="login-container">
            <h1 class="app-title">Sportaholics</h1>
            <p class="app-subtitle">Track. Compete. Dominate.</p>
            
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Enter your password" required>
                </div>
                
                <button type="submit" class="login-btn">Start Training</button>
                <div class="error-message" id="errorMessage">Invalid credentials. Try again.</div>
            </form>
        </div>
    </div>

    <!-- Main Application Screen -->
    <div id="appScreen">
        <div class="container">
            <div class="header">
                <div>
                    <h1 class="app-title">Sportaholics</h1>
                    <div class="user-welcome" id="userWelcome">Welcome, User!</div>
                </div>
                <button class="logout-btn" id="logoutBtn">Logout</button>
            </div>

            <!-- Workout Grid will be populated by JavaScript -->
            <div class="workout-grid" id="workoutGrid">
                <!-- Exercise cards will be inserted here -->
            </div>

            <div class="progress-section">
                <h2>Team Progress</h2>
                <!-- Progress bars and leaderboard will go here -->
            </div>
        </div>
    </div>
<!--scripts here -->
<script>
    // User credentials
    const users = {
        'reqasse@gmail.com': { 
            password: 'messi101',
            name: 'Mohammed',
            column: 'D' // Columns start from D for data
        },
        'ilyasssabir@gmail.com': { 
            password: 'ilyass1999',
            name: 'Ilyass', 
            column: 'E'
        },
        'souhayl4011@gmail.com': { 
            password: 'souhayl2003',
            name: 'Souhayl',
            column: 'F'
        },
        'hamzaboutchich@gmail.com': { 
            password: 'hamza2003',
            name: 'Hamza',
            column: 'G'
        }
    };

    // Google Sheets Configuration - YOU WILL NEED TO UPDATE THESE
    const SPREADSHEET_ID = '1ftW6sDYjwkapI7_mfaDmxReT0xZt_mvzmNlQwMjWpwI'; // You'll get this from your Google Sheet URL
    const API_KEY = 'AIzaSyAiuW33D33_Y8YIr5y6kqX4CYihKgTNUhk'; // You'll create this in Google Cloud Console
    const SHEET_RANGE = 'WorkoutData!A1:G11';
    // DOM Elements
    const loginScreen = document.getElementById('loginScreen');
    const appScreen = document.getElementById('appScreen');
    const loginForm = document.getElementById('loginForm');
    const errorMessage = document.getElementById('errorMessage');
    const userWelcome = document.getElementById('userWelcome');
    const workoutGrid = document.getElementById('workoutGrid');
    const logoutBtn = document.getElementById('logoutBtn');

    let currentUser = null;
    let workoutData = [];

    // Check if user is already logged in
    function checkExistingLogin() {
        const savedUser = localStorage.getItem('currentUser');
        if (savedUser && users[savedUser]) {
            currentUser = savedUser;
            showAppScreen(savedUser);
        }
    }

    // Login form handler
    loginForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        if (users[email] && users[email].password === password) {
            currentUser = email;
            localStorage.setItem('currentUser', email);
            await showAppScreen(email);
        } else {
            errorMessage.style.display = 'block';
        }
    });

    // Show main application screen
    async function showAppScreen(email) {
        const user = users[email];
        loginScreen.style.display = 'none';
        appScreen.style.display = 'block';
        
        userWelcome.textContent = `Welcome, ${user.name}! Ready to dominate? üí™`;
        
        // Load workout data from Google Sheets
        await loadWorkoutData();
        renderWorkoutGrid(user);
    }

    // Show/hide loading indicator
    function showLoading(isLoading) {
        const loadingElement = document.getElementById('loadingIndicator') || createLoadingElement();
        loadingElement.style.display = isLoading ? 'flex' : 'none';
    }

    // Create loading element if it doesn't exist
    function createLoadingElement() {
        const loadingDiv = document.createElement('div');
        loadingDiv.id = 'loadingIndicator';
        loadingDiv.style.display = 'none';
        loadingDiv.style.position = 'fixed';
        loadingDiv.style.top = '0';
        loadingDiv.style.left = '0';
        loadingDiv.style.right = '0';
        loadingDiv.style.bottom = '0';
        loadingDiv.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
        loadingDiv.style.justifyContent = 'center';
        loadingDiv.style.alignItems = 'center';
        loadingDiv.style.zIndex = '1000';
        loadingDiv.innerHTML = '<div style="color: white; font-size: 1.5rem;">Loading...</div>';
        document.body.appendChild(loadingDiv);
        return loadingDiv;
    }

    // Transform sheet data to our format
    function transformSheetData(sheetValues) {
        if (!sheetValues || sheetValues.length < 2) return [];
        
        const headers = sheetValues[0]; // First row: Exercise, Target, Mohammed, etc.
        return sheetValues.slice(1).map((row, index) => {
            const obj = { 
                exercise: row[0] || '', 
                target: row[1] || '',
                rowIndex: index + 2 // +2 because header row + 1-based indexing
            };
            
            // Add user statuses
            headers.slice(2, 6).forEach((header, colIndex) => {
                obj[header] = (row[colIndex + 2] || '‚ùå').trim();
            });
            
            return obj;
        }).filter(exercise => exercise.exercise); // Remove empty rows
    }

    // Load workout data from Google Sheets
    async function loadWorkoutData() {
        showLoading(true);
        try {
            console.log('üîç Fetching data from Google Sheets...');
            const data = await fetchSheetData();
            console.log('üìä Raw data from sheet:', data);
            
            if (!data || !data.values) {
                throw new Error('No data.values in response');
            }
            
            workoutData = transformSheetData(data.values);
            console.log('‚úÖ Transformed workout data:', workoutData);
            
            if (workoutData.length === 0) {
                console.warn('‚ö†Ô∏è No workout data found after transformation');
            }
            
            return workoutData;
        } catch (error) {
            console.error('‚ùå Failed to load sheet data:', error);
            // Don't use mock data - just show empty
            workoutData = [];
            alert('Failed to load workout data. Check console for details.');
            throw error; // Re-throw to be caught by the caller
        } finally {
            showLoading(false);
        }
    }


    // Fetch data from Google Sheets API
    async function fetchSheetData() {
        const range = 'WorkoutData!A1:G11'; // Using the exact range you specified
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${range}?key=${API_KEY}`;
        
        console.log('üåê Making request to:', url);
        
        try {
            const response = await fetch(url);
            
            if (!response.ok) {
                const errorText = await response.text();
                console.error('‚ùå API Error Response:', errorText);
                throw new Error(`API request failed with status ${response.status}: ${errorText}`);
            }
            
            const data = await response.json();
            console.log('üìÑ Raw API response:', data);
            
            if (!data.values || !Array.isArray(data.values) || data.values.length === 0) {
                throw new Error('No data found in the sheet or invalid format');
            }
            
            // Log the first few rows to verify data
            console.log('üìã First few rows of data:', data.values.slice(0, 3));
            
            return data;
            
        } catch (error) {
            console.error('‚ùå Error in fetchSheetData:', error);
            throw error; // Re-throw to be caught by the caller
        }
    }

    // Render workout exercises with interactive checkboxes
    function renderWorkoutGrid(currentUser) {
        workoutGrid.innerHTML = '';
        
        workoutData.forEach((exercise, index) => {
            const exerciseCard = document.createElement('div');
            exerciseCard.className = 'exercise-card';
            
            const userStatus = exercise[currentUser.name];
            const isCompleted = userStatus === '‚úÖ';
            
            exerciseCard.innerHTML = `
                <div class="exercise-header">
                    <div class="exercise-name">${exercise.exercise}</div>
                    <div class="exercise-target">${exercise.target}</div>
                </div>
                <div class="progress-container">
                    <div class="user-progress">
                        <div class="progress-row">
                            <span class="user-label">You (${currentUser.name}):</span>
                            <button class="check-btn ${isCompleted ? 'completed' : ''}" 
                                    data-exercise="${exercise.exercise}">
                                ${isCompleted ? '‚úÖ Completed' : '‚ùå Mark Complete'}
                            </button>
                        </div>
                        ${Object.entries(users)
                            .filter(([email, user]) => user.name !== currentUser.name)
                            .map(([email, user]) => `
                                <div class="progress-row">
                                    <span class="user-label">${user.name}:</span>
                                    <span class="status ${exercise[user.name] === '‚úÖ' ? 'completed' : 'pending'}">
                                        ${exercise[user.name] === '‚úÖ' ? '‚úÖ Completed' : '‚è≥ Pending'}
                                    </span>
                                </div>
                            `).join('')}
                    </div>
                </div>
            `;
            
            workoutGrid.appendChild(exerciseCard);
        });

        // Add event listeners to check buttons
        document.querySelectorAll('.check-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const exerciseName = this.getAttribute('data-exercise');
                toggleExerciseCompletion(exerciseName, this);
            });
        });

        updateProgressDashboard(currentUser);
    }

    // Update exercise status in Google Sheets
    async function updateSheetExercise(exerciseName, status) {
        const exercise = workoutData.find(e => e.exercise === exerciseName);
        if (!exercise) return;

        const row = exercise.rowIndex; // Row in the sheet (1-based)
        const column = users[currentUser].column; // Column for the current user (D, E, F, or G)
        const range = `WorkoutData!${column}${row}`;
        
        try {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${range}?valueInputOption=USER_ENTERED`;
            
            const response = await fetch(url, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    range: range,
                    majorDimension: 'ROWS',
                    values: [[status]]
                })
            });
            
            if (!response.ok) {
                throw new Error('Failed to update Google Sheet');
            }
            
            console.log('‚úÖ Successfully updated Google Sheet');
            return true;
        } catch (error) {
            console.error('‚ùå Error updating Google Sheet:', error);
            // Revert the UI if the update fails
            const button = document.querySelector(`[data-exercise="${exerciseName}"]`);
            if (button) {
                const newStatus = status === '‚úÖ' ? '‚ùå' : '‚úÖ';
                button.classList.toggle('completed');
                button.innerHTML = newStatus === '‚úÖ' ? '‚úÖ Completed' : '‚ùå Mark Complete';
            }
            alert('Failed to update exercise status. Please try again.');
            return false;
        }
    }

    // Toggle exercise completion status
    async function toggleExerciseCompletion(exerciseName, button) {
        const isCompleted = button.classList.contains('completed');
        const newStatus = isCompleted ? '‚ùå' : '‚úÖ';
        
        // Update UI immediately for better UX
        button.disabled = true;
        const originalHTML = button.innerHTML;
        button.innerHTML = 'Updating...';
        
        try {
            // Update local data first for instant feedback
            const exercise = workoutData.find(e => e.exercise === exerciseName);
            if (exercise) {
                exercise[currentUser.name] = newStatus;
            }
            
            // Update Google Sheet
            const success = await updateSheetExercise(exerciseName, newStatus);
            
            if (success) {
                // Update UI to reflect the new state
                if (newStatus === '‚úÖ') {
                    button.classList.add('completed');
                    button.innerHTML = '‚úÖ Completed';
                    // Add celebration effect
                    button.style.transform = 'scale(1.1)';
                    setTimeout(() => {
                        button.style.transform = 'scale(1)';
                    }, 200);
                } else {
                    button.classList.remove('completed');
                    button.innerHTML = '‚ùå Mark Complete';
                }
                
                // Update the progress dashboard
                updateProgressDashboard(users[currentUser]);
            }
        } catch (error) {
            console.error('Error toggling exercise:', error);
        } finally {
            button.disabled = false;
        }
    }

    // Update progress dashboard
    function updateProgressDashboard(user) {
        const userExercises = workoutData.filter(exercise => 
            exercise[user.name] === '‚úÖ'
        ).length;
        
        const totalExercises = workoutData.length;
        const completionPercent = Math.round((userExercises / totalExercises) * 100);
        
        // Update progress section
        const progressSection = document.querySelector('.progress-section');
        progressSection.innerHTML = `
            <h2>üèÜ Live Leaderboard</h2>
            <div class="dashboard-cards">
                <div class="stat-card">
                    <div class="stat-value">${userExercises}/${totalExercises}</div>
                    <div class="stat-label">Your Progress</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${completionPercent}%"></div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${getUserRank(user.name)}</div>
                    <div class="stat-label">Your Rank</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${getTeamCompletion()}%</div>
                    <div class="stat-label">Team Completion</div>
                </div>
            </div>
            <div class="leaderboard">
                <h3>Current Standings</h3>
                ${generateLeaderboard()}
            </div>
        `;
    }

    // Calculate user rank
    function getUserRank(userName) {
        const scores = Object.values(users).map(user => {
            const completed = workoutData.filter(exercise => 
                exercise[user.name] === '‚úÖ'
            ).length;
            return { name: user.name, completed };
        });
        
        scores.sort((a, b) => b.completed - a.completed);
        const rank = scores.findIndex(score => score.name === userName) + 1;
        
        switch(rank) {
            case 1: return '1st ü•á';
            case 2: return '2nd ü•à';
            case 3: return '3rd ü•â';
            case 4: return '4th üí™';
            default: return `${rank}th`;
        }
    }

    // Calculate team completion percentage
    function getTeamCompletion() {
        let totalCompleted = 0;
        let totalPossible = workoutData.length * Object.keys(users).length;
        
        workoutData.forEach(exercise => {
            Object.values(users).forEach(user => {
                if (exercise[user.name] === '‚úÖ') {
                    totalCompleted++;
                }
            });
        });
        
        return Math.round((totalCompleted / totalPossible) * 100);
    }

    // Generate leaderboard HTML
    function generateLeaderboard() {
        const scores = Object.values(users).map(user => {
            const completed = workoutData.filter(exercise => 
                exercise[user.name] === '‚úÖ'
            ).length;
            return { name: user.name, completed, total: workoutData.length };
        });
        
        scores.sort((a, b) => b.completed - a.completed);
        
        return scores.map((user, index) => `
            <div class="leaderboard-item ${user.name === users[currentUser].name ? 'current-user' : ''}">
                <div class="rank">${index + 1}</div>
                <div class="user-name">${user.name} ${user.name === users[currentUser].name ? '(You)' : ''}</div>
                <div class="user-score">${user.completed}/${user.total}</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${(user.completed/user.total)*100}%"></div>
                </div>
            </div>
        `).join('');
    }
// Debug function - add this to your script
async function testSheetsConnection() {
    console.log('=== Testing Sheets Connection ===');
    console.log('Sheet ID:', SPREADSHEET_ID);
    console.log('API Key:', API_KEY ? '***' + API_KEY.slice(-4) : 'MISSING');
    
    if (!SPREADSHEET_ID || SPREADSHEET_ID === 'YOUR_SHEET_ID_HERE') {
        console.error('‚ùå Sheet ID not configured');
        return;
    }
    
    if (!API_KEY || API_KEY === 'YOUR_API_KEY_HERE') {
        console.error('‚ùå API Key not configured');
        return;
    }

    try {
        const testUrl = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}?key=${API_KEY}`;
        console.log('Testing URL:', testUrl);
        
        const response = await fetch(testUrl);
        const data = await response.json();
        
        if (response.ok) {
            console.log('‚úÖ Sheets connection successful!');
            console.log('Sheet title:', data.properties.title);
        } else {
            console.error('‚ùå Sheets connection failed:', data.error);
        }
    } catch (error) {
        console.error('‚ùå Network error:', error);
    }
}

// Call this function right after your constants
testSheetsConnection();


// Add this debug function
async function debugSheetData() {
    console.log('=== Debugging Sheet Data ===');
    
    try {
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/WorkoutData!A1:G11?key=${API_KEY}`;
        console.log('Fetching URL:', url);
        
        const response = await fetch(url);
        const data = await response.json();
        
        console.log('Response status:', response.status);
        console.log('Full response:', data);
        
        if (data.values) {
            console.log('üìä Sheet data found:');
            data.values.forEach((row, index) => {
                console.log(`Row ${index}:`, row);
            });
        } else {
            console.log('‚ùå No data.values in response');
        }
    } catch (error) {
        console.error('Debug error:', error);
    }
}

// Call this right after testSheetsConnection()
debugSheetData();
    // Logout functionality
    logoutBtn.addEventListener('click', function() {
        currentUser = null;
        localStorage.removeItem('currentUser');
        appScreen.style.display = 'none';
        loginScreen.style.display = 'flex';
        loginForm.reset();
        errorMessage.style.display = 'none';
    });

    // Initialize app
    checkExistingLogin();
</script>
</body>
</html>